/* /css/navigation.css â€” NSMG classic nav (deduped)
   Works with: <ul id="nav-menu" class="nav-menu"> and .hamburger button in header.html
   Desktop: inline menu; white dropdowns w/ brand text; full-width brand hover
   Mobile: off-canvas drawer; scroll lock; same look/feel
*/

/* --- Theme bridge to global.css --- */
:root{
  --nav-gap: 1rem;
  --nav-drawer-w: 280px;
  --nav-border: rgba(0,0,0,0.08);
  --nav-focus: rgba(var(--primary-color-rgb), 0.45);
}

/* Keep logo square (global img rule rounds by default) */
.nav-container .site-logo { border-radius: 0; display:block; }

/* --------- Desktop (inline) --------- */
.nav-menu{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap: var(--nav-gap);
}
.nav-menu, .nav-menu ul{ list-style:none; margin:0; padding:0; }
.nav-menu li{ position:relative; }

.nav-menu > li > a{
  display:inline-block;
  text-decoration:none;
  font-weight:600;
  line-height:1.2;
  padding:.5rem .5rem;
  color: var(--text-light); /* header background is brand color */
}
.nav-menu > li > a:link,
.nav-menu > li > a:visited,
.nav-menu > li > a:hover,
.nav-menu > li > a:active{ color: var(--text-light); }

.nav-menu > li > a[aria-current="page"]{
  text-decoration: underline;
  text-underline-offset: 4px;
}

/* Dropdown panel (your markup uses .dropdown; we also accept .submenu) */
.nav-menu li > .dropdown,
.nav-menu li > .submenu{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  min-width: 220px;
  margin-top: 6px;
  background: var(--background-card); /* white */
  color: var(--text-main);
  border: 1px solid var(--nav-border);
  border-radius: 10px;
  box-shadow: 0 10px 25px rgba(0,0,0,.06);
  padding: 6px 0;
  z-index: 20;
}

/* Desktop hover; mobile visibility handled by .is-expanded */
.nav-menu > li:hover > .dropdown,
.nav-menu > li:hover > .submenu{ display:block; }
.is-expanded > .dropdown,
.is-expanded > .submenu{ display:block; }

/* Dropdown items: brand text, invert on hover */
.nav-menu li > .dropdown a,
.nav-menu li > .submenu a{
  display:block;
  padding:.5rem .9rem;
  font-weight:600;
  text-decoration: none;
  color: var(--primary-color);
}
.nav-menu li > .dropdown a:hover,
.nav-menu li > .submenu a:hover{
  background: var(--primary-color);
  color: var(--text-light);
}

/* Keyboard focus */
.nav-menu a:focus{
  outline:3px solid var(--nav-focus);
  outline-offset:2px;
}

/* Caret on expandable parents (ARIA toggled by JS) */
.nav-menu > li > a[aria-expanded="true"]::after,
.nav-menu > li > a[aria-expanded="false"]::after{
  content:""; display:inline-block; width:0; height:0; margin-left:.35em; vertical-align:middle;
  border-left:5px solid transparent; border-right:5px solid transparent;
}
.nav-menu > li > a[aria-expanded="false"]::after{ border-top:6px solid var(--text-light); }
.nav-menu > li > a[aria-expanded="true"]::after{  border-bottom:6px solid var(--text-light); }

/* --------- Hamburger (header button) --------- */
.hamburger,
.menu-toggle{
  background:none; border:0; padding:.25rem; cursor:pointer; color: var(--text-light);
  display:none; /* hidden on desktop; shown on mobile below */
}
.hamburger span,
.menu-toggle .menu-toggle-line{
  display:block; width:24px; height:2px; margin:5px 0; background: currentColor;
}

/* --------- Mobile (media query) --------- */
@media (max-width:1023px){
  .hamburger,
  .menu-toggle{ display:block; }

  .nav-menu{
    position: fixed;
    top:0; right:0;
    height:100vh; width: var(--nav-drawer-w);
    flex-direction: column;
    align-items: stretch;
    gap:0;
    padding:80px 16px 16px;               /* clears header area */
    background: var(--background-card);
    color: var(--text-main);
    transform: translateX(100%);
    transition: transform .25s ease;
    box-shadow: -12px 0 30px rgba(0,0,0,.12);
    border-left: 1px solid var(--nav-border);
    overflow-y:auto; z-index:1000;
  }
  .nav-menu.open{ transform: translateX(0); }

  html.nav-open, body.nav-open{ overflow:hidden; }

  .nav-menu > li{ width:100%; }
  
  /* FIXED: Dark text on white mobile drawer background */
  .nav-menu > li > a{
    color: var(--text-main);
    padding:.9rem .25rem;
    border-bottom:1px solid var(--nav-border);
  }
  
  /* FIXED: Ensure all link states use dark text */
  .nav-menu > li > a:link,
  .nav-menu > li > a:visited,
  .nav-menu > li > a:hover,
  .nav-menu > li > a:active{
    color: var(--text-main);
  }
  
  /* FIXED: Dark caret arrows for mobile */
  .nav-menu > li > a[aria-expanded="false"]::after{ 
    border-top-color: var(--text-main); 
  }
  .nav-menu > li > a[aria-expanded="true"]::after{  
    border-bottom-color: var(--text-main); 
  }

  /* Mobile dropdowns: stacked, indented */
  .nav-menu li > .dropdown,
  .nav-menu li > .submenu{
    position: static;
    background: transparent;
    border:0; box-shadow:none; margin:0; padding:0 0 .25rem 0;
  }
  .nav-menu li > .dropdown a,
  .nav-menu li > .submenu a{
    padding:.5rem 1rem .5rem 1.25rem;    /* indent */
    border-radius:6px;
    color: var(--primary-color);
  }
  .nav-menu li > .dropdown a:hover,
  .nav-menu li > .submenu a:hover{
    background: var(--primary-color);
    color: var(--text-light);
  }
}

/* --------- JS-controlled mobile mode (fallback / stabilization) --------- */
/* These rules apply whenever <html class="nav-mobile"> is present.
   They mirror the MQ behavior so mobile still works if MQs or viewport are off. */
html.nav-mobile .hamburger { display: inline-block; }

html.nav-mobile #nav-menu.nav-menu{
  position: fixed;
  top:0; right:0;
  height:100vh; width: var(--nav-drawer-w);
  transform: translateX(100%);
  transition: transform .25s ease;
  padding:80px 16px 16px;
  background: var(--background-card);
  color: var(--text-main);
  box-shadow: -12px 0 30px rgba(0,0,0,.12);
  border-left: 1px solid var(--nav-border);
  overflow-y:auto; z-index:1000;
  display:flex; flex-direction:column; align-items:stretch; gap:0;
}
html.nav-mobile #nav-menu.open{ transform: translateX(0); }

/* FIXED: Also apply dark text in JS-controlled mobile mode */
html.nav-mobile #nav-menu.nav-menu > li > a {
  color: var(--text-main);
}
html.nav-mobile #nav-menu.nav-menu > li > a:link,
html.nav-mobile #nav-menu.nav-menu > li > a:visited,
html.nav-mobile #nav-menu.nav-menu > li > a:hover,
html.nav-mobile #nav-menu.nav-menu > li > a:active {
  color: var(--text-main);
}

html.nav-mobile, html.nav-mobile body { overflow-x: hidden; }
html.nav-mobile.nav-open, html.nav-mobile body.nav-open { overflow: hidden; }